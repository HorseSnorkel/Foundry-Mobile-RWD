/**
 * Foundry Mobile RWD Styles
 * Responsive web design for FoundryVTT optimized for mobile and tablet devices
 */

/* ==========================================================================
   BASE RESPONSIVE SETTINGS
   ========================================================================== */

:root {
    --mobile-breakpoint: 768px;
    --tablet-breakpoint: 1024px;
    --touch-target-size: 44px;
    --mobile-padding: 8px;
    --mobile-margin: 4px;
}

/* ==========================================================================
   MOBILE DEVICE STYLES
   ========================================================================== */

@media (max-width: 768px) {
    body.mobile-device {
        font-size: 14px;
    }

    /* Hide map for mobile devices */
    body.mobile-device.hide-map #board {
        display: none !important;
    }

    body.mobile-device.hide-map #sidebar {
        left: 0 !important;
        width: 100% !important;
    }

    /* Sidebar adjustments for mobile */
    body.mobile-device #sidebar {
        width: 100% !important;
        left: 0 !important;
        border-left: none !important;
    }

    /* Navigation adjustments */
    body.mobile-device #navigation {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        top: auto !important;
        height: 60px;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
    }

    body.mobile-device #navigation #nav-toggle {
        display: none;
    }

    /* Controls adjustments */
    body.mobile-device #controls {
        position: fixed;
        top: 10px;
        right: 10px;
        width: auto;
        height: auto;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 8px;
        padding: var(--mobile-padding);
    }

    body.mobile-device #controls .control-tool {
        min-height: var(--touch-target-size);
        min-width: var(--touch-target-size);
        margin: 2px;
    }
}

/* ==========================================================================
   TABLET DEVICE STYLES
   ========================================================================== */

@media (min-width: 769px) and (max-width: 1024px) {
    body.tablet-device {
        font-size: 15px;
    }

    body.tablet-device #sidebar {
        width: 350px !important;
    }

    body.tablet-device.hide-map #sidebar {
        width: 100% !important;
        left: 0 !important;
    }

    body.tablet-device.hide-map #board {
        display: none !important;
    }
}

/* ==========================================================================
   TOUCH DEVICE ADJUSTMENTS
   ========================================================================== */

body.touch-device {
    /* Improve touch targets */
    .control-tool,
    .macro,
    button,
    input[type="button"],
    input[type="submit"] {
        min-height: var(--touch-target-size);
        min-width: var(--touch-target-size);
        touch-action: manipulation;
    }

    /* Remove hover effects for touch devices */
    * {
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
    }

    /* Improve scrolling */
    .scrollable {
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
    }
}

/* ==========================================================================
   ACTOR SHEET RESPONSIVE STYLES (Priority 1)
   ========================================================================== */

.window-app.mobile-optimized {
    max-width: 100vw !important;
    max-height: 100vh !important;
    border-radius: 0;
}

@media (max-width: 768px) {
    .window-app.mobile-optimized {
        width: 100vw !important;
        height: 100vh !important;
        top: 0 !important;
        left: 0 !important;
        border-radius: 0;
        border: none;
    }

    .window-app.mobile-optimized .window-header {
        height: 60px;
        padding: var(--mobile-padding) 16px;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        border-bottom: 2px solid #444;
    }

    .window-app.mobile-optimized .window-title {
        font-size: 18px;
        font-weight: bold;
    }

    .window-app.mobile-optimized .window-content {
        height: calc(100vh - 60px) !important;
        padding: var(--mobile-padding);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* Character sheet specific optimizations */
    .mobile-optimized .sheet-header {
        display: flex;
        flex-direction: column;
        gap: var(--mobile-margin);
        margin-bottom: 16px;
        padding: 12px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
    }

    .mobile-optimized .sheet-header img {
        max-width: 80px;
        max-height: 80px;
        border-radius: 50%;
        align-self: center;
    }

    .mobile-optimized .sheet-header .charname {
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        margin: 8px 0;
    }

    /* Touch-friendly tabs */
    .mobile-optimized .sheet-tabs {
        display: flex;
        justify-content: space-around;
        margin-bottom: 16px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        overflow: hidden;
    }

    .mobile-optimized .sheet-tabs .item {
        flex: 1;
        padding: 12px 8px;
        text-align: center;
        min-height: var(--touch-target-size);
        display: flex;
        align-items: center;
        justify-content: center;
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        transition: background-color 0.2s;
    }

    .mobile-optimized .sheet-tabs .item:last-child {
        border-right: none;
    }

    .mobile-optimized .sheet-tabs .item.active {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    /* Form elements optimization */
    .mobile-optimized input,
    .mobile-optimized select,
    .mobile-optimized textarea {
        padding: 12px;
        font-size: 16px; /* Prevent zoom on iOS */
        border-radius: 6px;
        border: 1px solid #444;
        background: rgba(0, 0, 0, 0.3);
        color: #fff;
        width: 100%;
        box-sizing: border-box;
    }

    .mobile-optimized .touch-friendly {
        min-height: var(--touch-target-size);
        padding: 12px;
        touch-action: manipulation;
    }
}

/* ==========================================================================
   CHAT LOG RESPONSIVE STYLES (Priority 2)
   ========================================================================== */

@media (max-width: 768px) {
    #sidebar-tabs {
        height: 50px;
        background: rgba(0, 0, 0, 0.8);
    }

    #sidebar-tabs .item {
        min-height: var(--touch-target-size);
        padding: 8px 12px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #chat-log {
        height: calc(100vh - 180px) !important; /* Account for tabs and controls */
    }

    body.compact-chat #chat-log .message {
        padding: 8px 12px;
        margin-bottom: 4px;
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    body.compact-chat #chat-log .message .message-header {
        margin-bottom: 4px;
        font-size: 14px;
    }

    body.compact-chat #chat-log .message .message-content {
        font-size: 14px;
        line-height: 1.4;
    }

    body.compact-chat #chat-log .message .message-timestamp {
        font-size: 11px;
        opacity: 0.7;
    }

    /* Chat form optimization */
    #chat-form {
        padding: var(--mobile-padding);
        background: rgba(0, 0, 0, 0.8);
        border-top: 1px solid #444;
    }

    #chat-form #chat-message {
        padding: 12px;
        font-size: 16px; /* Prevent zoom on iOS */
        border-radius: 20px;
        border: 1px solid #444;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        resize: none;
        min-height: 44px;
    }

    #chat-form #chat-controls {
        margin-top: var(--mobile-margin);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #chat-form button {
        min-height: var(--touch-target-size);
        min-width: var(--touch-target-size);
        border-radius: 6px;
        padding: 8px 16px;
        touch-action: manipulation;
    }
}

/* ==========================================================================
   HOTBAR/MACRO BAR RESPONSIVE STYLES (Priority 3)
   ========================================================================== */

@media (max-width: 768px) {
    body.mobile-hotbar-enabled #hotbar {
        position: fixed;
        bottom: 70px; /* Above navigation */
        left: 0;
        right: 0;
        height: 60px;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        border-top: 1px solid #444;
        z-index: 999;
    }

    body.mobile-hotbar-enabled #hotbar #macro-list {
        display: flex;
        justify-content: space-around;
        align-items: center;
        height: 100%;
        padding: 0 var(--mobile-padding);
    }

    body.mobile-hotbar-enabled #hotbar .macro {
        width: var(--touch-target-size);
        height: var(--touch-target-size);
        border-radius: 8px;
        margin: 0 2px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        touch-action: manipulation;
        transition: all 0.2s;
    }

    body.mobile-hotbar-enabled #hotbar .macro:hover,
    body.mobile-hotbar-enabled #hotbar .macro:active {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.05);
    }

    body.mobile-hotbar-enabled #hotbar .macro img {
        width: 32px;
        height: 32px;
        border-radius: 4px;
    }

    /* Hide page controls on mobile */
    body.mobile-hotbar-enabled #hotbar #macro-directory {
        display: none;
    }
}

@media (min-width: 769px) and (max-width: 1024px) {
    body.tablet-device.mobile-hotbar-enabled #hotbar {
        height: 70px;
    }

    body.tablet-device.mobile-hotbar-enabled #hotbar .macro {
        width: 50px;
        height: 50px;
        margin: 0 4px;
    }

    body.tablet-device.mobile-hotbar-enabled #hotbar .macro img {
        width: 36px;
        height: 36px;
    }
}

/* ==========================================================================
   DIALOG AND POPUP OPTIMIZATIONS
   ========================================================================== */

@media (max-width: 768px) {
    .dialog {
        max-width: 95vw !important;
        max-height: 90vh !important;
        border-radius: 12px;
        overflow: hidden;
    }

    .dialog .window-content {
        padding: 16px;
    }

    .dialog button {
        min-height: var(--touch-target-size);
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 8px;
        touch-action: manipulation;
    }

    /* Context menus */
    .context-menu {
        min-width: 200px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    }

    .context-menu .context-item {
        padding: 12px 16px;
        min-height: var(--touch-target-size);
        display: flex;
        align-items: center;
        touch-action: manipulation;
    }
}

/* ==========================================================================
   UTILITY CLASSES
   ========================================================================== */

.mobile-hidden {
    display: none !important;
}

@media (min-width: 769px) {
    .mobile-only {
        display: none !important;
    }
}

@media (max-width: 768px) {
    .desktop-only {
        display: none !important;
    }
}

.touch-scroll {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
}

.no-select {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* ==========================================================================
   ACCESSIBILITY IMPROVEMENTS
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* Focus indicators for keyboard navigation */
body.touch-device *:focus {
    outline: 2px solid #007acc;
    outline-offset: 2px;
}

/* ==========================================================================
   RESPONSIVE LAYOUT ADJUSTMENTS
   ========================================================================== */

@media (max-width: 768px) {
    /* Stack elements vertically on mobile */
    .flexrow {
        flex-direction: column !important;
    }

    .flexrow > * {
        margin-bottom: var(--mobile-margin);
    }

    /* Improve spacing */
    .form-group {
        margin-bottom: 16px;
    }

    .form-group label {
        display: block;
        margin-bottom: 4px;
        font-weight: bold;
    }

    /* Better button layouts */
    .form-footer,
    .dialog-buttons {
        display: flex;
        flex-direction: column;
        gap: var(--mobile-margin);
    }

    .form-footer button,
    .dialog-buttons button {
        width: 100%;
        margin: 0;
    }
}